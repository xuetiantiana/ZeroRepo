import{i as q}from"./index-CVOXnaBf.js";import{s as K,v as V,o as G,c as H,a as S}from"./index-_LG_nvQj.js";const J={class:""},Q=S("div",{class:"header"},[S("h3",null,"echart"),S("div",{id:"main",style:{width:"100vw",height:"100vh"}})],-1),X=[Q],I={__name:"echart",setup(Y){let C=1;const y={};let c=[],u=[],n={},$={},m=new Set,h=[],f=[],k=null;function v(t){function i(e,a,r=0,o="",p="",g=null,s=""){for(const d in e)if(e.hasOwnProperty(d)){const l=C+++"";let b=d;y[b]=l;const D=p?"".concat(p,"/").concat(d):d;a&&(n[a]||(n[a]=[]),n[a].push(l),$[l]=a);let z="box",_={border:"#B0C4DE",background:"#F0F8FF",highlight:{border:"#4682B4",background:"#ADD8E6"}};if(Array.isArray(e[d])){_={border:"#D3D3D3",background:"#F5F5F5",highlight:{border:"#A9A9A9",background:"#E0E0E0"}};let w={id:l,label:b,name:b,originalLabel:b,title:"".concat(D),path:D,shape:z,color:_,font:{size:14,bold:!0},level:r,widthConstraint:{minimum:101,maximum:101},isArrayContainer:!0,rootId:g,rootLabel:s,category:s};if(c.push(w),a){let E={source:a,target:l};u.push(E)}e[d].forEach((E,M)=>{const A=C+++"",F=typeof E=="string"?E:"Item ".concat(M+1),L="".concat(D,"/").concat(F);n[l]||(n[l]=[]),n[l].push(A),$[A]=l;let R={id:A,label:F,name:F,title:"".concat(L),path:L,shape:"box",color:{border:"#FFD700",background:"#FFFACD",highlight:{border:"#DAA520",background:"#FFFFE0"}},font:{size:14,bold:!0},level:r+1,heightConstraint:{minimum:20},widthConstraint:{minimum:101,maximum:101},rootId:g,rootLabel:s,category:s};c.push(R);let U={source:l,target:A};u.push(U)})}else if(typeof e[d]=="object"&&e[d]!==null){_={border:"#D3D3D3",background:"#F5F5F5",highlight:{border:"#A9A9A9",background:"#E0E0E0"}};let w={id:l,label:b,name:b,title:"".concat(D),path:D,shape:z,color:_,font:{size:14,bold:!0},level:r,widthConstraint:{minimum:101,maximum:101},rootId:g,rootLabel:s,category:s};if(Object.keys(e[d]).length>0&&(w.originalLabel=b),c.push(w),a){let E={source:a,target:l};u.push(E)}i(e[d],l,r+1,b,D,g,s)}}}t.subtrees&&Array.isArray(t.subtrees)&&t.subtrees.forEach((e,a)=>{const r=C+++"",o=e.name||"Unnamed Subtree";let p={border:"#6495ED",background:"#E6E6FA",highlight:{border:"#4149E1",background:"#D8BFD8"}},g={id:r,label:o,name:o,symbolSize:80,originalLabel:o,title:"".concat(o),file_path:e.file_path||"N/A",shape:"box",color:p,font:{size:16,bold:!0,color:"#000"},margin:10,widthConstraint:{minimum:150,maximum:150},heightConstraint:{minimum:20,maximum:20},level:0,hidden:!1,sortOrder:a,rootId:r,rootLabel:o,category:o,showIcon:!0,iconType:"root"};c.push(g),y[o]=r,e.refactored_subtree&&i(e.refactored_subtree,r,1,o,o,r,o)}),t.data_flow_graph&&Array.isArray(t.data_flow_graph)&&(console.log("？？？",y),t.data_flow_graph.forEach(e=>{const a=y[e.from],r=y[e.to];if(a&&r){let o={source:a,target:r,type:"rootLink",label:{show:!0,formatter:e.data_type||e.label||""},name:e.data_id||"",data_id:e.data_id||"",transformation:e.transformation||"",lineStyle:{color:"red",width:3,opacity:.9,type:"dashed"},emphasis:{lineStyle:{color:"#c0392b",width:6,opacity:1,shadowColor:"#c0392b",shadowBlur:15}}};u.push(o)}else console.warn("Could not create edge for flow:",e,"due to missing node IDs.")})),console.log("数据处理完成",c,u,n,$,y),B()}function B(){h=[],f=[],c.forEach(t=>{t.level===0&&h.push({...t,label:{show:!0,formatter:function(i){const e=n[i.data.id]&&n[i.data.id].length>0,a=m.has(i.data.id),r=e?a?"▼":"▶":"";return"".concat(r," ").concat(i.data.name)}}})}),u.forEach(t=>{t.type==="rootLink"&&f.push(t)})}function T(t){n[t]&&n[t].length>0&&(m.has(t)?(N(t),m.delete(t)):(O(t),m.add(t)),P())}function O(t){(n[t]||[]).forEach(e=>{const a=c.find(o=>o.id===e);a&&!h.find(o=>o.id===e)&&h.push({...a,label:{show:!0,formatter:function(o){const p=n[o.data.id]&&n[o.data.id].length>0,g=m.has(o.data.id),s=p?g?"▼":"▶":"";return"".concat(s," ").concat(o.data.name)}}});const r=u.find(o=>o.source===t&&o.target===e);r&&!f.find(o=>o.source===t&&o.target===e)&&f.push(r)})}function N(t){(n[t]||[]).forEach(e=>{m.has(e)&&(N(e),m.delete(e)),h=h.filter(a=>a.id!==e),f=f.filter(a=>!(a.source===t&&a.target===e)&&!(a.source===e||a.target===e))})}function P(){k&&k.setOption({series:[{roam:!0,data:h,edges:f}]})}K(()=>{const t=document.getElementById("main");if(!t)return;const i=q(t);fetch("./data/webui.json").then(e=>e.json()).then(e=>{v(e),W(i)}),V(()=>{i.dispose()})});const x=[{name:"Algorithms"},{name:"Workflow"},{name:"Data Engineering"},{name:"Advanced Modeling Techniques"}],W=t=>{k=t;const i={tooltip:{trigger:"item",formatter:function(e){if(e.dataType==="edge")return e.data.type==="rootLink"?"🔗 数据流连接<br/>"+"从：".concat(e.data.source,"<br/>")+"到：".concat(e.data.target,"<br/>")+"数据类型：".concat(e.data.label||"无","<br/>")+"数据ID：".concat(e.data.data_id||"无","<br/>")+"转换说明：".concat(e.data.transformation?e.data.transformation.substring(0,50)+"...":"无"):"🔗 从 ".concat(e.data.source," 到 ").concat(e.data.target,"<br/>名称：").concat(e.data.name||"无");if(e.dataType==="node")return"节点：".concat(e.data.name,"<br/>path：").concat(e.data.path||"无","<br/>id：").concat(e.data.id)}},legend:[{data:x.map(function(e){return e.name})}],series:[{type:"graph",roam:!0,layout:"force",animation:!1,symbolSize:50,animation:!1,data:c,force:{initLayout:"circular",gravity:.5,repulsion:500,edgeLength:150,layoutAnimation:!0},lineStyle:{color:"#999",width:1,opacity:.5,curveness:.1},edgeSymbol:["none","arrow"],edgeSymbolSize:[4,8],edges:u,edgeLabel:{show:!1,position:"middle",fontSize:10,color:"#666",backgroundColor:"rgba(255, 255, 255, 0.8)",borderRadius:3,padding:[2,4],formatter:function(e){return e.data.label&&e.data.label.formatter?e.data.label.formatter:""}},categories:x,label:{show:!0,position:"inside",fontSize:10,color:"#333",formatter:function(e){return e.data.label&&e.data.label.formatter?e.data.label.formatter(e):e.data.name||e.data.label}},emphasis:{focus:"adjacency",lineStyle:{color:"#999",opacity:1,shadowColor:"#ff4757",shadowBlur:10},itemStyle:{borderColor:"#ff4757",borderWidth:3,shadowColor:"#ff4757",shadowBlur:10},label:{color:"#ff4757",fontWeight:"bold",fontSize:12},edgeLabel:{show:!0,color:"red",fontSize:12,backgroundColor:"rgba(255, 71, 87, 0.1)",padding:[3,6]},blurScope:"none"},blur:{lineStyle:{opacity:.2},itemStyle:{opacity:1},label:{opacity:1}}}]};console.log("setsss",f,h),t.setOption(i),t.on("click",function(e){e.dataType==="node"&&T(e.data.id)})};return(t,i)=>(G(),H("div",J,X))}};export{I as default};
