import{h as Ie,g as Le}from"./util-Co76Ilmi.js";import{d as he,r as A,o as g,c as m,a,t as k,F as E,b as W,e as P,n as re,p as Q,f as ee,_ as te,g as Fe,h as K,i as fe,w as Re,j as We,k as ce,l as de,m as Pe,q as Ae,s as Oe}from"./index-HGGtu3Ip.js";import{i as Ve}from"./index-CVOXnaBf.js";const oe=c=>(Q("data-v-338d3613"),c=c(),ee(),c),Ge={key:0,class:"body"},qe={class:"info-item"},He=oe(()=>a("span",{class:"info-label"},"node:",-1)),Ue={class:"info-value"},je={class:"info-item"},Xe=oe(()=>a("span",{class:"info-label"},"feature_path:",-1)),Ye={class:"info-value"},Ze={key:0,class:"info-file_pat_"},Je={class:"info-label"},Ke={class:"info-value"},Qe={key:0,style:{"margin-top":"0.5em"}},et=["onClick"],tt={key:1},ot={key:2,style:{"margin-top":"0.5em"}},nt=oe(()=>a("b",{style:{"margin-top":"0.5em"}},"methods: ",-1)),st={key:0,class:"info-file_pat_"},lt={class:"info-label"},at={class:"info-value"},it={class:"info-label"},rt=["onClick"],ct=he({__name:"nodeDetailComponent",props:{currNode:{type:Object,required:!0,default:()=>({})}},setup(c){const B=A(new Set),v=y=>{B.value.has(y)?B.value.delete(y):B.value.add(y)},T=y=>B.value.has(y);return(y,I)=>c.currNode&&c.currNode.metaData?(g(),m("div",Ge,[a("div",qe,[He,a("span",Ue,k(c.currNode.metaData.node),1)]),a("div",je,[Xe,a("span",Ye,k(c.currNode.metaData.feature_path),1)]),(g(!0),m(E,null,W(c.currNode.metaData.file_paths,(x,d)=>(g(),m("div",{key:d,class:"info-item"},[(g(!0),m(E,null,W(x,(h,_,N)=>(g(),m(E,{key:N},[_!=="extra"?(g(),m("div",Ze,[a("span",Je,k(_)+":",1),a("span",Ke,k(h),1)])):P("",!0)],64))),128)),x.extra?(g(),m("div",Qe,[(g(!0),m(E,null,W(x.extra,(h,_,N)=>(g(),m(E,{key:N},[_=="docstring"?(g(),m("div",{key:0,class:re(["info-docstring",{expanded:T("".concat(d,"-").concat(_))}])},[a("b",null,k(_)+": ",1),a("span",{class:"docstring-content",onClick:$=>v("".concat(d,"-").concat(_))},k(h),9,et)],2)):_!=="methods"?(g(),m("p",tt,[a("b",null,k(_)+": ",1),a("span",null,k(h),1)])):_=="methods"?(g(),m("div",ot,[nt,(g(!0),m(E,null,W(h,($,R)=>(g(),m("div",{key:R,style:{"margin-bottom":"0.5em"}},[(g(!0),m(E,null,W($,(O,p,L)=>(g(),m(E,{key:L},[p!=="docstring"?(g(),m("div",st,[a("span",lt,k(p)+":",1),a("span",at,k(O),1)])):p=="docstring"?(g(),m("div",{key:1,class:re(["info-docstring",{expanded:T("".concat(d,"-").concat(R,"-").concat(p))}])},[a("span",it,k(p)+":",1),a("span",{class:"docstring-content",onClick:M=>v("".concat(d,"-").concat(R,"-").concat(p))},k(O),9,rt)],2)):P("",!0)],64))),128))]))),128))])):P("",!0)],64))),128))])):P("",!0)]))),128))])):P("",!0)}}),ue=te(ct,[["__scopeId","data-v-338d3613"]]),ge=c=>(Q("data-v-d3705f72"),c=c(),ee(),c),dt={class:"sidebar"},ut=ge(()=>a("div",{class:"sidebar-header"},[a("h2",null,"ZeroRepo")],-1)),ht={class:"sidebar-content"},ft={class:"current-node-box",ref:"nodeModalRef"},gt={class:"select-node-item",style:{border:"2px solid #2b7ce9","box-shadow":"0 8px 24px rgba(43, 124, 233, 0.4)"}},mt={class:"node-header"},pt={class:"node-title"},vt=ge(()=>a("span",{style:{color:"#2b7ce9"}},"CurrNode:  ",-1)),_t={class:"node-body"},yt={style:{padding:"1em 1em 0","border-top":"1px solid #aaa","margin-top":"1em"}},bt={style:{margin:"0 0 1em"}},xt={class:"selected-nodes-box"},St=["onClick"],Nt={class:"node-body"},$t=he({__name:"SelectedNodesPanel",props:{selectedNodeList:{type:Array,required:!0,default:[]},currNode:{type:Object,required:!0,default:()=>({})},maxSelectedNodes:{type:Number,required:!0,default:0}},emits:["removeSelectedNode"],setup(c,{emit:B}){const v=c,T=B,y=N=>{console.log(v.selectedNodeList),T("removeSelectedNode",N)},I=A(""),x=A(null),d=A({});function h(N,$){N&&(d.value[$]=N)}function _(N){N!=null&&We(()=>{const $=d.value[N];$&&x.value&&$.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})})}return(N,$)=>{const R=ce("el-option"),O=ce("el-select");return g(),m("div",null,[a("div",dt,[ut,a("div",ht,[a("div",ft,[a("div",gt,[a("div",mt,[a("h3",pt,[vt,Fe(" "+k(c.currNode&&c.currNode.metaData?c.currNode.metaData.node:"节点信息"),1)])]),a("div",_t,[c.currNode&&c.currNode.metaData?(g(),K(ue,{key:0,currNode:c.currNode},null,8,["currNode"])):P("",!0)])])],512),a("div",yt,[a("h4",bt," 已选择的节点 ("+k(c.selectedNodeList.length)+" / "+k(c.maxSelectedNodes)+") ",1),fe(O,{modelValue:I.value,"onUpdate:modelValue":$[0]||($[0]=p=>I.value=p),filterable:"",placeholder:"Type to search yours added nodes below...",clearable:"",style:{width:"100%"},onChange:_},{default:Re(()=>[(g(!0),m(E,null,W(c.selectedNodeList,(p,L)=>{var M;return g(),K(R,{key:p.id,label:((M=p.metaData)==null?void 0:M.node)||p.label,value:L},null,8,["label","value"])}),128))]),_:1},8,["modelValue"])]),a("div",xt,[a("div",{ref_key:"selectedNodesScrollContainer",ref:x,class:"selected-nodes-list"},[(g(!0),m(E,null,W(c.selectedNodeList,(p,L)=>(g(),m("div",{key:L,ref_for:!0,ref:M=>h(M,L),class:"select-node-item"},[a("div",{class:"node-header",style:de({"border-left":"4px solid ".concat(p.selectedColor)})},[a("h3",{class:"node-title",style:de({color:p.selectedColor})},k(p.metaData.node),5),a("button",{class:"close-btn",onClick:M=>y(p.feature_path)}," × ",8,St)],4),a("div",Nt,[p&&p.metaData?(g(),K(ue,{key:0,currNode:p},null,8,["currNode"])):P("",!0)])]))),128))],512)])])])])}}}),wt=te($t,[["__scopeId","data-v-d3705f72"]]),me=c=>(Q("data-v-2f1cf950"),c=c(),ee(),c),Ct={class:""},kt={style:{height:"100vh"}},Tt={id:"viewport",style:{display:"flex"}},Mt=me(()=>a("div",{id:"echart",style:{width:"100%",height:"100%"}},null,-1)),Dt=me(()=>a("span",{class:"icon"},"+",-1)),Bt=[Dt],zt={__name:"echart3",setup(c){let B=null,v={nodes:[],links:[]},T=1,y=null,I=!1,x=null,d=null;const h=A([]),_=A(10),N=A();Pe(_,(e,n)=>{if(console.log("最大选择数量从 ".concat(n," 变更为 ").concat(e)),h.value.length>e){const s=h.value.slice(e);h.value=h.value.slice(0,e),console.log("由于限制变更，移除了以下节点:",s),alert("由于限制变更，已移除 ".concat(s.length," 个节点"))}}),Ae(()=>{const e=document.getElementById("echart").getBoundingClientRect().width,n=document.getElementById("echart").getBoundingClientRect().height,s=Math.min(e,n);T=Math.max(2200/s,1),d=document.getElementById("plusButton"),Me(),console.log("屏幕尺寸：",e,n,2200/s,T);const t=document.getElementById("echart");t&&(y=Ve(t),Promise.all([fetch("./data/webui.json").then(o=>o.json()),fetch("./data/map.json").then(o=>o.json())]).then(([o,i])=>{console.log("webui:",o),console.log("map:",i),R(o.data_flow_graph),B=Ie(o,i),xe(1),v=se(B),Ne(y)}).catch(o=>{console.error("请求失败:",o)}),Oe(()=>{y.dispose()}))});const $=[],R=e=>{e.forEach(n=>{const s=n.from,t=n.to;if(s&&t){const o={source:"1_"+s,target:"1_"+t,type:"rootLink",content:n,label:{show:!0,formatter:n.data_type||n.label||"",color:"#000",fontSize:9,position:"middle"},lineStyle:{color:"#000",width:1,type:"dashed",opacity:1},symbol:["circle","arrow"],symbolSize:[4,8]};$.push(o)}}),console.log($)};function O(e){const n=[{name:"test1",x:e,y:e},{name:"test2",x:-e,y:-e},{name:"test3",x:-e,y:e},{name:"test4",x:e,y:-e}];return console.log("Dddd"),n.map(s=>({...s,id:s.name,itemStyle:{opacity:0},label:{show:!1}}))}const p=O(500),L=["#686759","#B04B35","#E37C05","#5F9DBF","#568651","#B89C80"],M=["#686759","#4EA3F9","#528FB7","#52E0FC","#40C2F2","#BAD7F3"],ne=e=>{let n;return e==0?n=5:e==1?n=100/T:e==2?n=80/T:e==3?n=48/T:e==4?n=38/T:n=30/T,n},pe=e=>e<=1?{color:M[e%M.length],borderColor:M[e%M.length],borderWidth:.5,opacity:1}:{color:M[e%M.length],borderColor:M[e%M.length],borderWidth:.5},ve=e=>({color:e==1?"rgba(0,0,0,.1)":L[e%L.length],width:1}),_e=(e,n=0,s="",t=0,o)=>{if(e>=5){let r=n*180/Math.PI;const b=ye(0,0,(o==null?void 0:o.x)+0,(o==null?void 0:o.y)+0,100,s),w=ne(5);return{show:!0,position:[b.dx+w,b.dy+w],fontSize:12,color:"#333",fontWeight:"normal",align:"center",verticalAlign:"middle",rotate:r>90&&r<270?180-r:-r,formatter:function(l){var f=l.name||"";if(l&&l.data&&l.data.level>=5)return r>90&&r<270?"{main|".concat(f,"    } {sub|}"):"{sub|} {main|    ".concat(f,"}");for(var u=f.split(" "),D=[],F=0;F<u.length;F++){var C=u[F];if(C.indexOf("-")!==-1)for(var S=C.split("-"),z=0;z<S.length;z++)D.push(S[z]),z<S.length-1&&D.push("-");else D.push(C)}return D.join("\n")},rich:{main:{fontSize:10,color:"#000"},sub:{fontSize:10,color:"rgba(0, 0, 0, .1)",height:-1}}}}let i={};return e==0?i={fontSize:12,color:"#333",fontWeight:"normal"}:i={position:"inside",fontSize:11,color:"#333",verticalAlign:"middle",align:"center",fontWeight:e===1?"bold":"normal",width:200},i};function X(e,n=10,s="Arial"){const o=(X._canvas||(X._canvas=document.createElement("canvas"))).getContext("2d");return o.font="".concat(n,"px ").concat(s),o.measureText(e).width}const ye=(e,n,s,t,o=30,i)=>{i.length*3,o=X(i)/2+12;const b=s-e,w=t-n,l=Math.atan2(w,b),f=l*(180/Math.PI),u=Math.cos(l)*o,D=Math.sin(l)*o;return{dx:u,dy:D,angleDeg:f}},be=e=>({0:0,1:100,2:180,3:270,4:360,5:500})[e]||420+(e-6)*40,se=e=>{function n(l){if(!l||l.visible===!1)return null;const f={...l};return f.children&&Array.isArray(f.children)&&(f.children=f.children.map(n).filter(u=>!!u)),f}const s=n(e);console.log("开始转换为 Graph 数据格式 treeData",s);const t=[],o=[],i=new Map;function r(l,f=0){function u(C){let S=1;return C<=1?S=1:C==1?S=.75:C==2?S=.5:C==3?S=.3:C==4?S=.25:S=.08,S}if(!l.children||l.children.length===0)return u(f);const D=l.children.reduce((C,S)=>C+r(S,f+1),0),F=u(f);return Math.max(D,F)}function b(l,f=null,u=0,D=0,F=2*Math.PI){if(!l||!l.name||l.visible===!1)return;const C=u+"_"+(l.feature_path||l.name),S=be(u);let z,q=0,j=0;u===0?(q=0,j=0,z=0):(z=(D+F)/2,q=Math.cos(z)*S,j=Math.sin(z)*S);const De={id:C,name:l.name||"Unknown",feature_path:l.feature_path||"",level:u,metaData:l.metaData,x:q,y:j,angle:z,sectorStart:D,sectorEnd:F,fixed:!0,symbolSize:l.symbolSize||ne(u),label:_e(u,z,l.name||"",S,{x:q,y:j}),itemStyle:l.itemStyle||pe(u),category:u};if(u!=0&&t.push(De),i.set(l.name,C),f&&u>=2&&o.push({source:f,target:C,lineStyle:l.lineStyle||ve(u)}),l.children&&l.children.length>0){const le=l.children.map(H=>r(H,u+1)),Be=le.reduce((H,J)=>H+J,0);let ae=F-D;u===0&&(ae=2*Math.PI);let Z=D;l.children.forEach((H,J)=>{const ze=le[J]/Be*ae,Ee=Z,ie=Z+ze;b(H,C,u+1,Ee,ie),Z=ie})}}b(s,null,0,0,2*Math.PI),console.log("Graph 节点布局完成，节点数量:",t.length,t,o),Le(s)<=2?$.forEach(l=>{l.label.show=!0}):$.forEach(l=>{l.label.show=!1});let w=[...$,...o];return console.log("!!!linksResult",w),{nodes:[...p,...t],links:w}},xe=e=>{function n(s,t){s.visible=t<=e,s.children&&s.children.length>0&&s.children.forEach(o=>n(o,t+1))}B&&n(B,0)},Se=e=>{function n(o,i){if(o.feature_path===i)return o;if(o.children)for(const r of o.children){const b=n(r,i);if(b)return b}return null}const s=n(B,e);let t=!1;if(s&&s.children){for(const o of s.children)if(o.visible===!1){t=!0;break}s.children.forEach(o=>{if(o.visible=!o.visible,!o.visible&&o.children){const i=r=>{r.visible=!1,r.children&&r.children.forEach(i)};i(o)}})}return t},Ne=e=>{if(!v||!v.nodes||v.nodes.length===0){console.error("Graph 数据不存在或为空:",v);return}console.log("初始化 Graph 图表，节点数量:",v.nodes.length);var n={tooltip:{trigger:"item",triggerOn:"mousemove",extraCssText:"max-width: 400px; white-space: normal;",formatter:function(t){if(t.dataType==="node"){const o=t.data;let i="<strong>Node: </strong> ".concat(o.name,"<br/>");return o.feature_path&&(i+="<strong>Feature Path: </strong> ".concat(o.feature_path,"<br/>")),i}if(t.dataType==="edge"&&t.data&&t.data.type==="rootLink"){let o="<strong>Flow Graph:</strong><br/>";return o+="<strong>From: </strong> ".concat(t.data.content.from,"<br/>"),o+="<strong>To: </strong> ".concat(t.data.content.to,"<br/>"),t.data.label&&t.data.label.formatter&&(o+="<strong>Data Type: </strong> ".concat(t.data.content.data_type,"<br/>")),o}return t.dataType==="edge"?"":t.name||""}},series:[{type:"graph",layout:"none",roam:!0,zoom:T,center:[0,0],scaleLimit:{min:T*.7,max:T*1.2},data:v.nodes,links:v.links,symbol:"circle",symbolSize:30,label:{show:!0,position:function(t){return t&&t.data&&t.data.level>=5?"right":"inside"},fontSize:function(t){return t&&t.data&&t.data.level>=5?10:12},formatter:function(t){var o=t.name||"";if(t&&t.data&&t.data.level>=5)return o+" - 111111"+o;for(var i=o.split(" "),r=[],b=0;b<i.length;b++){var w=i[b];if(w.indexOf("-")!==-1)for(var l=w.split("-"),f=0;f<l.length;f++)r.push(l[f]),f<l.length-1&&r.push("-");else r.push(w)}return r.join("\n")}},lineStyle:{color:"source",curveness:0,width:1},animationDurationUpdate:750,animationEasingUpdate:"quinticInOut"}]};e.setOption(n),setTimeout(()=>{if(v.nodes&&v.nodes.length>0){const t=v.nodes[0];Y(t)}},100),e.on("mouseover",function(t){if(t.componentType==="series"&&t.dataType==="node"&&t.data.level>1){const o=t.data.feature_path;if(clearTimeout(G),V===o)return;V=o,Y(t.data)}}),e.on("mouseout",function(t){if(t.componentType==="series"&&t.dataType==="node"&&t.data.level>1){const o=t.data.feature_path;if(V!==o)return;clearTimeout(G),G=setTimeout(()=>{V===o&&!Ce()&&(U(),V=null)},200)}});let s=null;e.on("graphRoam",function(){I=!0,console.log("拖拽/缩放开始",x),U(),s&&(clearTimeout(s),s=null),s=setTimeout(()=>{console.log("///// 重新设置图表选项"),e.setOption({series:[{data:v.nodes,links:v.links}]})},500),setTimeout(()=>{I=!1,console.log("拖拽/缩放结束")},300)}),e.on("mousedown",function(){console.log("mousedown"),I=!0,U()}),e.on("mouseup",function(){console.log("mouseup"),setTimeout(()=>{I=!1,console.log("鼠标操作结束")},100)}),e.on("click",function(t){if(t.dataType==="node"){console.log("params.data",t.data);const o=t.data.feature_path;Se(o),v=se(B),e.setOption({series:[{data:v.nodes,links:v.links}]}),$e(t.data),t.data.level>1&&(N.value=t.data)}})};function $e(e){if(!y||!e)return;console.log("@@@",e);const n=y.convertToPixel({seriesIndex:0},[e.x,e.y]),s=y.getDom(),t=s.offsetWidth,o=s.offsetHeight,r=80*y.getModel().getSeriesByIndex(0).option.zoom,[b,w]=n;let l=!1;if((b<r||b>t-r||w<r||w>o-r)&&(l=!0),l){console.log("needMove");const{x:f,y:u}=e;if(Math.sqrt(f*f+u*u)===0)return;y.setOption({series:[{center:[e.x,e.y]}]})}}const we=()=>{if(!(x&&x.level<=1)&&x){const e=x.feature_path;if(h.value.some(s=>s.feature_path===e))console.log("点击减号，移除节点:",x),h.value=h.value.filter(s=>s.feature_path!==e);else{if(h.value.length>=_.value){alert("最多只能选择 ".concat(_.value," 个节点！"));return}console.log("点击加号，添加节点:",x),h.value.unshift(x)}console.log("当前选择的节点列表:",h.value),Y(x)}},Y=e=>{if(!(!d||I))try{const n=h.value.some(l=>l.feature_path===e.feature_path),s=y.convertToPixel("series",[e.x,e.y]),t=e.symbolSize||30;console.log(s);const i=y.getModel().getSeriesByIndex(0).coordinateSystem.getRoamTransform();let r=1;Array.isArray(i)&&i.length===6?r=i[0]:i&&typeof i.zoom=="number"&&(r=i.zoom);const b=t/2*r*Math.sin(Math.PI/4),w=-t/2*r*Math.sin(Math.PI/4);d.style.left=s[0]+b+"px",d.style.top=s[1]+w+"px",d.style.display="flex",n?(d.getElementsByClassName("icon")[0].textContent="−",d.style.backgroundColor="#f56c6c",d.title="点击取消选择"):h.value.length>=_.value?(d.getElementsByClassName("icon")[0].textContent="+",d.style.backgroundColor="#909399",d.title="已达到最大选择数量 (".concat(h.value.length,"/").concat(_.value,")")):(d.getElementsByClassName("icon")[0].textContent="+",d.style.backgroundColor="#409eff",d.title="点击选择节点 (".concat(h.value.length,"/").concat(_.value,")")),x=e}catch(n){console.error("显示按钮失败:",n)}},U=()=>{clearTimeout(G),d&&(d.style.display="none"),x=null,V=null},Ce=()=>d?d.matches(":hover"):!1,ke=e=>{h.value=h.value.filter(n=>n.feature_path!==e),console.log("移除节点:",e),console.log("当前选择的节点列表:",h.value)},Te=e=>{_.value=e,console.log("从组件更新最大选择节点数量为:",e)},Me=()=>{d&&(d.addEventListener("mouseenter",()=>{console.log("鼠标进入加号按钮"),clearTimeout(G)}),d.addEventListener("mouseleave",()=>{console.log("鼠标离开加号按钮"),U()}))};let G=null,V=null;return(e,n)=>(g(),m("div",Ct,[a("div",kt,[a("div",Tt,[fe(wt,{style:{width:"20%","min-width":"300px","max-width":"600px"},selectedNodeList:h.value,maxSelectedNodes:_.value,currNode:N.value,onRemoveSelectedNode:ke,onUpdateMaxNodes:Te},null,8,["selectedNodeList","maxSelectedNodes","currNode"]),a("div",{id:"wrapper",style:{flex:"1",overflow:"hidden",height:"100%"}},[Mt,a("div",{id:"plusButton",class:"plus-button",style:{display:"none"},onClick:we},Bt)])])])]))}},Ft=te(zt,[["__scopeId","data-v-2f1cf950"]]);export{Ft as default};
