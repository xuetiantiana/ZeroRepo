import{h as He,g as pe}from"./util-DzJ6JAqp.js";import{d as be,r as W,o as g,c as p,a,t as w,F as z,b as L,e as O,n as _e,p as le,f as ae,_ as ie,g as oe,h as ne,i as te,j as Z,w as se,k as Ue,l as ve,m as Xe,q as Ye,s as Ze}from"./index-D2X4RJqq.js";import{i as Je}from"./index-CVOXnaBf.js";const re=c=>(le("data-v-ae8090cc"),c=c(),ae(),c),Ke={key:0,class:"body"},Qe={class:"info-item"},et=re(()=>a("span",{class:"info-label"},"Node:",-1)),tt={class:"info-value"},ot={class:"info-item"},nt=re(()=>a("span",{class:"info-label"},"Feature Path:",-1)),st={class:"info-value"},lt={key:0,class:"info-file_pat_"},at={class:"info-label"},it={class:"info-value"},rt={key:0,style:{"margin-top":"0.5em"}},ct=["onClick"],dt={key:1},ut={key:2,style:{"margin-top":"0.5em"}},ht=re(()=>a("b",{style:{"margin-top":"0.5em"}},"methods: ",-1)),ft={key:0,class:"info-file_pat_"},gt={class:"info-label"},mt={class:"info-value"},pt={class:"info-label"},_t=["onClick"],vt=be({__name:"nodeDetailComponent",props:{currNode:{type:Object,required:!0,default:()=>({})}},setup(c){const T=W(new Set),y=m=>{T.value.has(m)?T.value.delete(m):T.value.add(m)},k=m=>T.value.has(m);return(m,A)=>c.currNode&&c.currNode.metaData?(g(),p("div",Ke,[a("div",Qe,[et,a("span",tt,w(c.currNode.metaData.node),1)]),a("div",ot,[nt,a("span",st,w(c.currNode.metaData.feature_path),1)]),(g(!0),p(z,null,L(c.currNode.metaData.file_paths,(S,d)=>(g(),p("div",{key:d,class:"info-item"},[(g(!0),p(z,null,L(S,(h,v,b)=>(g(),p(z,{key:b},[v!=="extra"?(g(),p("div",lt,[a("span",at,w(v)+":",1),a("span",it,w(h),1)])):O("",!0)],64))),128)),S.extra?(g(),p("div",rt,[(g(!0),p(z,null,L(S.extra,(h,v,b)=>(g(),p(z,{key:b},[v=="docstring"?(g(),p("div",{key:0,class:_e(["info-docstring",{expanded:k("".concat(d,"-").concat(v))}])},[a("b",null,w(v)+": ",1),a("span",{class:"docstring-content",onClick:x=>y("".concat(d,"-").concat(v))},w(h),9,ct)],2)):v!=="methods"?(g(),p("p",dt,[a("b",null,w(v)+": ",1),a("span",null,w(h),1)])):v=="methods"?(g(),p("div",ut,[ht,(g(!0),p(z,null,L(h,(x,D)=>(g(),p("div",{key:D,style:{"margin-bottom":"0.5em"}},[(g(!0),p(z,null,L(x,(P,u,B)=>(g(),p(z,{key:B},[u!=="docstring"?(g(),p("div",ft,[a("span",gt,w(u)+":",1),a("span",mt,w(P),1)])):u=="docstring"?(g(),p("div",{key:1,class:_e(["info-docstring",{expanded:k("".concat(d,"-").concat(D,"-").concat(u))}])},[a("span",pt,w(u)+":",1),a("span",{class:"docstring-content",onClick:E=>y("".concat(d,"-").concat(D,"-").concat(u))},w(P),9,_t)],2)):O("",!0)],64))),128))]))),128))])):O("",!0)],64))),128))])):O("",!0)]))),128))])):O("",!0)}}),ye=ie(vt,[["__scopeId","data-v-ae8090cc"]]),xe=c=>(le("data-v-7d2975f5"),c=c(),ae(),c),yt={class:"sidebar"},bt=xe(()=>a("div",{class:"sidebar-header"},[a("h2",null,"ZeroRepo")],-1)),xt={class:"sidebar-content"},Nt={class:"current-node-box",ref:"nodeModalRef"},St={class:"select-node-item",style:{border:"2px solid #2b7ce9","box-shadow":"0 8px 24px rgba(43, 124, 233, 0.4)"}},$t={class:"node-header"},wt={class:"node-title",style:{"padding-right":"0"}},Mt=xe(()=>a("span",{style:{color:"#2b7ce9"}},"CurrNode:  ",-1)),Ct={class:"node-body"},Tt={style:{padding:"1em 1em 0","border-top":"1px solid #aaa","margin-top":"1em"}},kt={style:{margin:"0 0 1em"}},Dt={class:"selected-nodes-box"},Bt=["onClick"],Et={class:"node-body"},It=be({__name:"SelectedNodesPanel",props:{selectedNodeList:{type:Array,required:!0,default:[]},currNode:{type:Object,required:!0,default:()=>({})},maxSelectedNodes:{type:Number,required:!0,default:0}},emits:["removeSelectedNode"],setup(c,{emit:T}){const y=c,k=T,m=b=>{console.log(y.selectedNodeList),k("removeSelectedNode",b)},A=W(""),S=W(null),d=W({});function h(b,x){b&&(d.value[x]=b)}function v(b){b!=null&&Ue(()=>{const x=d.value[b];x&&S.value&&x.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})})}return(b,x)=>{const D=oe("el-option"),P=oe("el-select");return g(),p("div",null,[a("div",yt,[bt,a("div",xt,[a("div",Nt,[a("div",St,[a("div",$t,[a("h3",wt,[Mt,ne(" "+w(c.currNode&&c.currNode.metaData?c.currNode.originalName?c.currNode.originalName+" ("+c.currNode.name+")":c.currNode.metaData.node:"节点信息"),1)])]),a("div",Ct,[c.currNode&&c.currNode.metaData?(g(),te(ye,{key:0,currNode:c.currNode},null,8,["currNode"])):O("",!0)])])],512),a("div",Tt,[a("h4",kt," Added Nodes ("+w(c.selectedNodeList.length)+") ",1),Z(P,{modelValue:A.value,"onUpdate:modelValue":x[0]||(x[0]=u=>A.value=u),filterable:"",placeholder:"Type to search yours added nodes below...",clearable:"",style:{width:"100%"},onChange:v},{default:se(()=>[(g(!0),p(z,null,L(c.selectedNodeList,(u,B)=>{var E;return g(),te(D,{key:u.id,label:((E=u.metaData)==null?void 0:E.node)||u.label,value:B},null,8,["label","value"])}),128))]),_:1},8,["modelValue"])]),a("div",Dt,[a("div",{ref_key:"selectedNodesScrollContainer",ref:S,class:"selected-nodes-list"},[(g(!0),p(z,null,L(c.selectedNodeList,(u,B)=>(g(),p("div",{key:B,ref_for:!0,ref:E=>h(E,B),class:"select-node-item"},[a("div",{class:"node-header",style:ve({"border-left":"4px solid ".concat(u.selectedColor)})},[a("h3",{class:"node-title",style:ve({color:u.selectedColor})},w(u.originalName?u.originalName+" ("+u.name+")":u.metaData.node),5),a("button",{class:"close-btn",onClick:E=>m(u.feature_path)}," × ",8,Bt)],4),a("div",Et,[u&&u.metaData?(g(),te(ye,{key:0,currNode:u},null,8,["currNode"])):O("",!0)])]))),128))],512)])])])])}}}),zt=ie(It,[["__scopeId","data-v-7d2975f5"]]),Ne=c=>(le("data-v-ad2f2e1c"),c=c(),ae(),c),At={class:""},Ft={style:{height:"100vh"}},Rt={id:"viewport",style:{display:"flex"}},Wt={id:"wrapper",style:{flex:"1",overflow:"hidden",height:"100%"}},Pt=Ne(()=>a("div",{id:"echart",style:{width:"100%",height:"100%"}},null,-1)),Lt=Ne(()=>a("span",{class:"icon"},"+",-1)),Ot=[Lt],Vt={class:"showAllNodes",style:{position:"absolute",right:"20px",top:"5px"}},jt={style:{position:"absolute",right:"150px",top:"5px"}},Gt={__name:"echart3",setup(c){let T=null,y={nodes:[],links:[]},k=1,m=null,A=!1,S=null,d=null;const h=W([]),v=W(1e6),b=W();let x=0,D=0,P=[];Xe(v,(t,n)=>{if(console.log("最大选择数量从 ".concat(n," 变更为 ").concat(t)),h.value.length>t){const e=h.value.slice(t);h.value=h.value.slice(0,t),console.log("由于限制变更，移除了以下节点:",e),alert("由于限制变更，已移除 ".concat(e.length," 个节点"))}});let u=1e3,B=1e3;Ye(()=>{u=document.getElementById("echart").getBoundingClientRect().width,B=document.getElementById("echart").getBoundingClientRect().height;const t=Math.min(u,B);k=Math.max(2500/t,1),d=document.getElementById("plusButton"),Oe(),console.log("屏幕尺寸：",u,B,2500/t,k);const n=document.getElementById("echart");n&&(m=Je(n),Promise.all([fetch("./data/webui.json").then(e=>e.json()),fetch("./data/map.json").then(e=>e.json())]).then(([e,o])=>{console.log("webui:",e),console.log("map:",o),$e(e.data_flow_graph),T=He(e,o),de(1),y=K(T),ze(m)}).catch(e=>{console.error("请求失败:",e)}),Ze(()=>{m.dispose()}))});const E=W(!1),Se=t=>{E.value=!E.value,t=E.value?5:1,de(t),y=K(T),m.setOption({series:[{data:y.nodes,links:y.links}]}),m.setOption({series:[{center:[0,0]}]})},G=[],$e=t=>{t.forEach(n=>{const e=n.from,o=n.to;if(e&&o){const s={source:"1_"+e,target:"1_"+o,type:"rootLink",content:n,label:{show:!0,formatter:n.data_type||n.label||"",color:"#000",fontSize:9,position:"middle"},lineStyle:{color:"#000",width:1,type:"dashed",opacity:1},symbol:["circle","arrow"],symbolSize:[4,8]};G.push(s)}}),console.log(G)};function we(t){const n=[{name:"test1",x:t,y:t},{name:"test2",x:-t,y:-t},{name:"test3",x:-t,y:t},{name:"test4",x:t,y:-t}];return console.log("Dddd"),n.map(e=>({...e,id:e.name,itemStyle:{opacity:0},label:{show:!1}}))}const Me=we(680),Ce=t=>({0:0,1:125,2:215,3:310,4:400,5:500})[t]||420+(t-6)*40,F=["#686759","#0068B8","#62BDE4","#52E0FC","#86DCF8","#BAD7F3"],Te={"Advanced Modeling Techniques":"#FF8364",Algorithms:"#5414E9",Workflow:"#00C6A2","Data Engineering":"#0368FF"},ce=t=>{let n;return t==0?n=5:t==1?n=100/k:t==2?n=80/k:t==3?n=70/k:t==4?n=38/k:n=30/k,n},ke=(t,n)=>{if(console.log("!!@@@@",n,b.value),t<=1)return{color:F[t%F.length],borderColor:F[t%F.length],borderWidth:.5,opacity:1};{let e=!1;return b.value&&b.value.id2==n.id&&(e=!0),{color:F[t%F.length],borderColor:F[t%F.length],borderWidth:.5,shadowColor:e?"rgb(43, 124, 233)":"transparent",shadowBlur:20}}},De=(t,n)=>({color:t==1?"rgba(0,0,0,.1)":Te[n.level1Root]||"rgba(0,0,0,.4)",width:1}),Be=(t,n=0,e="",o=0,s)=>{if(t>=5){let r=n*180/Math.PI;const _=Ee(0,0,(s==null?void 0:s.x)+0,(s==null?void 0:s.y)+0,100,e),$=ce(5);return{show:!0,position:[_.dx+$,_.dy+$],fontSize:10,color:"#333",fontWeight:"normal",align:"center",verticalAlign:"middle",rotate:r>90&&r<270?180-r:-r}}let i={};return t==0?i={fontSize:12,color:"#333",fontWeight:"normal"}:i={position:"inside",fontSize:t===1?12:11,color:t==1?"#fff":"#333",verticalAlign:"middle",align:"center",fontWeight:t===1?"bold":"normal",width:200},i};function J(t,n=10,e="Arial"){const s=(J._canvas||(J._canvas=document.createElement("canvas"))).getContext("2d");return s.font="".concat(n,"px ").concat(e),s.measureText(t).width}const Ee=(t,n,e,o,s=30,i)=>{i.length*3,s=J(i)/2+25;const _=e-t,$=o-n,l=Math.atan2($,_),N=l*(180/Math.PI),f=Math.cos(l)*s,I=Math.sin(l)*s;return{dx:f,dy:I,angleDeg:N}},K=t=>{function n(l){if(!l||l.visible===!1)return null;const N={...l};return N.children&&Array.isArray(N.children)&&(N.children=N.children.map(n).filter(f=>!!f)),N}const e=n(t);console.log("开始转换为 Graph 数据格式 treeData",e),P=e;const o=[],s=[],i=new Map;function r(l,N=0){function f(M){let C=1;return M<=1?C=1:M==1?C=.75:M==2?C=.5:M==3?C=.3:M==4?C=.25:C=.08,C}if(!l.children||l.children.length===0)return f(N);const I=l.children.reduce((M,C)=>M+r(C,N+1),0),j=f(N);return Math.max(I,j)}function _(l,N=null,f=0,I=0,j=2*Math.PI){if(!l||!l.name||l.visible===!1)return;const M=f<=1?f+"_"+(l.feature_path||l.name):f+"_"+l.id+"_"+(l.feature_path||l.name),C=Ce(f);let R,X=0,Y=0;f===0?(X=0,Y=0,R=0):(R=(I+j)/2,X=Math.cos(R)*C,Y=Math.sin(R)*C);const Ve={id:M,id2:l.id,name:l.name||"Unknown",originalName:l.originalName?l.originalName:null,feature_path:l.feature_path||"",level:f,metaData:l.metaData,x:X,y:Y,angle:R,sectorStart:I,sectorEnd:j,fixed:!0,symbolSize:l.symbolSize||ce(f),label:Be(f,R,l.name||"",C,{x:X,y:Y}),itemStyle:l.itemStyle||ke(f,l),category:f};if(f!=0&&o.push(Ve),i.set(l.name,M),N&&f>=2&&s.push({source:N,target:M,lineStyle:l.lineStyle||De(f,l)}),l.children&&l.children.length>0){const fe=l.children.map(H=>r(H,f+1)),je=fe.reduce((H,ee)=>H+ee,0);let ge=j-I;f===0&&(ge=2*Math.PI);let Q=I;l.children.forEach((H,ee)=>{const Ge=fe[ee]/je*ge,qe=Q,me=Q+Ge;_(H,M,f+1,qe,me),Q=me})}}_(e,null,0,0,2*Math.PI),console.log("Graph 节点布局完成，节点数量:",o.length,o,s),pe(e)<=2?G.forEach(l=>{l.label.show=!0}):G.forEach(l=>{l.label.show=!1});let $=[...G,...s];return console.log("!!!linksResult",$),{nodes:[...Me,...o],links:$}},de=t=>{function n(e,o){e.visible=o<=t,e.children&&e.children.length>0&&e.children.forEach(s=>n(s,o+1))}T&&n(T,0)},Ie=t=>{function n(s,i){if(s.feature_path===i)return s;if(s.children)for(const r of s.children){const _=n(r,i);if(_)return _}return null}const e=n(T,t);let o=!1;if(e&&e.children){for(const s of e.children)if(s.visible===!1){o=!0;break}e.children.forEach(s=>{if(s.visible=!s.visible,!s.visible&&s.children){const i=r=>{r.visible=!1,r.children&&r.children.forEach(i)};i(s)}})}return o},ze=t=>{if(!y||!y.nodes||y.nodes.length===0){console.error("Graph 数据不存在或为空:",y);return}console.log("初始化 Graph 图表，节点数量:",y.nodes.length);var n={tooltip:{trigger:"item",triggerOn:"mousemove",extraCssText:"max-width: 400px; white-space: normal;",formatter:function(e){if(e.dataType==="node"){const o=e.data;let s="<strong>Node: </strong>".concat(o.originalName?o.originalName+" ("+o.name+")":o.name," <br/>");return o.feature_path&&(s+="<strong>Feature Path: </strong> ".concat(o.feature_path,"<br/>")),s}if(e.dataType==="edge"&&e.data&&e.data.type==="rootLink"){let o="<strong>Flow Graph:</strong><br/>";return o+="<strong>From: </strong> ".concat(e.data.content.from,"<br/>"),o+="<strong>To: </strong> ".concat(e.data.content.to,"<br/>"),e.data.label&&e.data.label.formatter&&(o+="<strong>Data Type: </strong> ".concat(e.data.content.data_type,"<br/>")),o}return e.dataType==="edge"?"":e.name||""}},series:[{type:"graph",layout:"none",roam:"move",zoom:k,center:[0,0],data:y.nodes,links:y.links,symbol:"circle",symbolSize:30,label:{show:!0,position:function(e){return e&&e.data&&e.data.level>=5?"right":"inside"},fontSize:function(e){return e&&e.data&&e.data.level>=5?10:12},formatter:function(e){var o=e.name||"";if(e&&e.data&&e.data.level>=3)return o;for(var s=o.split(" "),i=[],r=0;r<s.length;r++){var _=s[r];i.push(_)}return i.join("\n")}},lineStyle:{color:"source",curveness:0,width:1},animationDurationUpdate:750,animationEasingUpdate:"quinticInOut"}]};t.setOption(n),t.on("mouseover",function(e){if(e.componentType==="series"&&e.dataType==="node"&&e.data.level>1){const o=e.data.feature_path;if(clearTimeout(q),V===o)return;V=o,he(e.data)}}),t.on("mouseout",function(e){if(e.componentType==="series"&&e.dataType==="node"&&e.data.level>1){const o=e.data.feature_path;if(V!==o)return;clearTimeout(q),q=setTimeout(()=>{V===o&&!We()&&(U(),V=null)},200)}}),setTimeout(()=>{[,,,,x,D]=t.getModel().getSeriesByIndex(0).coordinateSystem.getRoamTransform(),console.log("初始偏移量:",{initialTranslateX:x,initialTranslateY:D})},100),t.on("graphRoam",function(){A=!0,U(),setTimeout(()=>{A=!1,console.log("拖拽/缩放结束")},300),Ae()}),t.on("mousedown",function(){console.log("mousedown"),A=!0,U()}),t.on("mouseup",function(){console.log("mouseup"),setTimeout(()=>{A=!1,console.log("鼠标操作结束")},100)}),t.on("click",function(e){if(e.dataType==="node"){console.log("params.data",e.data),e.data.level>1?b.value=e.data:b.value=null;const o=e.data.feature_path;Ie(o),y=K(T),t.setOption({series:[{data:y.nodes,links:y.links}]}),Fe(e.data)}})},Ae=()=>{let t=pe(P);console.log("depth",t);const e=m.getModel().getSeriesByIndex(0).coordinateSystem.getRoamTransform(),[,,,,o,s]=e,i=1500/5*(t-1),r=Math.min((i-u)/2+u,i),_=Math.min((i-B)/2+B,i);let $=o,l=s;console.log(u,B),Math.abs(o-x)>r&&($=o>x?x+r:x-r),Math.abs(s-D)>_&&(l=s>D?D+_:D-_),console.log("&&",o,s),console.log("x移动了多少",Math.abs(o-x),"最多可拖拽",r),console.log("y移动了多少",Math.abs(s-D),"最多可拖拽",_),($!==o||l!==s)&&(ue(),console.log("aaa",$-o,l-s))},ue=()=>{m.setOption({series:[{center:[0,0]}]}),setTimeout(()=>{m.setOption({series:[{data:y.nodes}]})},100)};function Fe(t){if(!m||!t)return;console.log("@@@",t);const n=m.convertToPixel({seriesIndex:0},[t.x,t.y]),e=m.getDom(),o=e.offsetWidth,s=e.offsetHeight,i=m.getModel().getSeriesByIndex(0).option.zoom,r=80*i,[_,$]=n;let l=!1;if((_<r||_>o-r||$<r||$>s-r)&&(l=!0),l){console.log("needMove");const{x:N,y:f}=t,I=Math.sqrt(N*N+f*f);if(I===0)return;const M=Math.max(0,I-200/i)/I,C=N*M,R=f*M;m.setOption({series:[{center:[C,R]}]})}}const Re=()=>{if(!(S&&S.level<=1)&&S){const t=S.feature_path;if(h.value.some(e=>e.feature_path===t))console.log("点击减号，移除节点:",S),h.value=h.value.filter(e=>e.feature_path!==t);else{if(h.value.length>=v.value){alert("最多只能选择 ".concat(v.value," 个节点！"));return}console.log("点击加号，添加节点:",S),h.value.unshift(S),console.log("!!!!",h)}console.log("当前选择的节点列表:",h.value),he(S)}},he=t=>{if(!(!d||A))try{const n=h.value.some(l=>l.feature_path===t.feature_path),e=m.convertToPixel("series",[t.x,t.y]),o=t.symbolSize||30;console.log(e);const i=m.getModel().getSeriesByIndex(0).coordinateSystem.getRoamTransform();let r=1;Array.isArray(i)&&i.length===6?r=i[0]:i&&typeof i.zoom=="number"&&(r=i.zoom);const _=o/2*r*Math.sin(Math.PI/4),$=-o/2*r*Math.sin(Math.PI/4);d.style.left=e[0]+_+"px",d.style.top=e[1]+$+"px",d.style.display="flex",n?(d.getElementsByClassName("icon")[0].textContent="−",d.style.backgroundColor="#f56c6c",d.title="点击取消选择"):h.value.length>=v.value?(d.getElementsByClassName("icon")[0].textContent="+",d.style.backgroundColor="#909399",d.title="已达到最大选择数量 (".concat(h.value.length,"/").concat(v.value,")")):(d.getElementsByClassName("icon")[0].textContent="+",d.style.backgroundColor="#409eff",d.title="点击选择节点 (".concat(h.value.length,"/").concat(v.value,")")),S=t}catch(n){console.error("显示按钮失败:",n)}},U=()=>{clearTimeout(q),d&&(d.style.display="none"),S=null,V=null},We=()=>d?d.matches(":hover"):!1,Pe=t=>{h.value=h.value.filter(n=>n.feature_path!==t),console.log("移除节点:",t),console.log("当前选择的节点列表:",h.value)},Le=t=>{v.value=t,console.log("从组件更新最大选择节点数量为:",t)},Oe=()=>{d&&(d.addEventListener("mouseenter",()=>{console.log("鼠标进入加号按钮"),clearTimeout(q)}),d.addEventListener("mouseleave",()=>{console.log("鼠标离开加号按钮"),U()}))};let q=null,V=null;return(t,n)=>{const e=oe("el-button");return g(),p("div",At,[a("div",Ft,[a("div",Rt,[Z(zt,{style:{width:"20%","min-width":"300px","max-width":"600px"},selectedNodeList:h.value,maxSelectedNodes:v.value,currNode:b.value,onRemoveSelectedNode:Pe,onUpdateMaxNodes:Le},null,8,["selectedNodeList","maxSelectedNodes","currNode"]),a("div",Wt,[Pt,a("div",{id:"plusButton",class:"plus-button",style:{display:"none"},onClick:Re},Ot),a("div",Vt,[Z(e,{style:{width:"120px"},color:"rgb(43, 124, 233)",type:"primary",onClick:n[0]||(n[0]=o=>Se(E.value))},{default:se(()=>[ne(w(E.value?"Close All Nodes":"Show All Nodes"),1)]),_:1})]),a("div",jt,[Z(e,{style:{width:"120px"},color:"rgb(43, 124, 233)",type:"primary",onClick:ue},{default:se(()=>[ne(" Center View")]),_:1})])])])])])}}},Xt=ie(Gt,[["__scopeId","data-v-ad2f2e1c"]]);export{Xt as default};
