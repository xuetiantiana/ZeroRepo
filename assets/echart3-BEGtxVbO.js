import{h as Pe,g as Re}from"./util-D5u2CTna.js";import{d as me,r as O,o as f,c as p,a,t as M,F as E,b as F,e as W,n as he,p as ne,f as se,_ as le,g as te,h as pe,i as ee,j as oe,w as _e,k as Ae,l as fe,m as Fe,q as We,s as Oe}from"./index-Bw2TYYMq.js";import{i as Ve}from"./index-CVOXnaBf.js";const ae=r=>(ne("data-v-ae8090cc"),r=r(),se(),r),je={key:0,class:"body"},Ge={class:"info-item"},qe=ae(()=>a("span",{class:"info-label"},"Node:",-1)),He={class:"info-value"},Ue={class:"info-item"},Xe=ae(()=>a("span",{class:"info-label"},"Feature Path:",-1)),Ye={class:"info-value"},Ze={key:0,class:"info-file_pat_"},Je={class:"info-label"},Ke={class:"info-value"},Qe={key:0,style:{"margin-top":"0.5em"}},et=["onClick"],tt={key:1},ot={key:2,style:{"margin-top":"0.5em"}},nt=ae(()=>a("b",{style:{"margin-top":"0.5em"}},"methods: ",-1)),st={key:0,class:"info-file_pat_"},lt={class:"info-label"},at={class:"info-value"},it={class:"info-label"},rt=["onClick"],ct=me({__name:"nodeDetailComponent",props:{currNode:{type:Object,required:!0,default:()=>({})}},setup(r){const T=O(new Set),m=_=>{T.value.has(_)?T.value.delete(_):T.value.add(_)},k=_=>T.value.has(_);return(_,L)=>r.currNode&&r.currNode.metaData?(f(),p("div",je,[a("div",Ge,[qe,a("span",He,M(r.currNode.metaData.node),1)]),a("div",Ue,[Xe,a("span",Ye,M(r.currNode.metaData.feature_path),1)]),(f(!0),p(E,null,F(r.currNode.metaData.file_paths,(x,d)=>(f(),p("div",{key:d,class:"info-item"},[(f(!0),p(E,null,F(x,(h,y,S)=>(f(),p(E,{key:S},[y!=="extra"?(f(),p("div",Ze,[a("span",Je,M(y)+":",1),a("span",Ke,M(h),1)])):W("",!0)],64))),128)),x.extra?(f(),p("div",Qe,[(f(!0),p(E,null,F(x.extra,(h,y,S)=>(f(),p(E,{key:S},[y=="docstring"?(f(),p("div",{key:0,class:he(["info-docstring",{expanded:k("".concat(d,"-").concat(y))}])},[a("b",null,M(y)+": ",1),a("span",{class:"docstring-content",onClick:D=>m("".concat(d,"-").concat(y))},M(h),9,et)],2)):y!=="methods"?(f(),p("p",tt,[a("b",null,M(y)+": ",1),a("span",null,M(h),1)])):y=="methods"?(f(),p("div",ot,[nt,(f(!0),p(E,null,F(h,(D,B)=>(f(),p("div",{key:B,style:{"margin-bottom":"0.5em"}},[(f(!0),p(E,null,F(D,(V,g,P)=>(f(),p(E,{key:P},[g!=="docstring"?(f(),p("div",st,[a("span",lt,M(g)+":",1),a("span",at,M(V),1)])):g=="docstring"?(f(),p("div",{key:1,class:he(["info-docstring",{expanded:k("".concat(d,"-").concat(B,"-").concat(g))}])},[a("span",it,M(g)+":",1),a("span",{class:"docstring-content",onClick:R=>m("".concat(d,"-").concat(B,"-").concat(g))},M(V),9,rt)],2)):W("",!0)],64))),128))]))),128))])):W("",!0)],64))),128))])):W("",!0)]))),128))])):W("",!0)}}),ge=le(ct,[["__scopeId","data-v-ae8090cc"]]),ye=r=>(ne("data-v-ee29cc75"),r=r(),se(),r),dt={class:"sidebar"},ut=ye(()=>a("div",{class:"sidebar-header"},[a("h2",null,"ZeroRepo")],-1)),ht={class:"sidebar-content"},ft={class:"current-node-box",ref:"nodeModalRef"},gt={class:"select-node-item",style:{border:"2px solid #2b7ce9","box-shadow":"0 8px 24px rgba(43, 124, 233, 0.4)"}},mt={class:"node-header"},pt={class:"node-title",style:{"padding-right":"0"}},_t=ye(()=>a("span",{style:{color:"#2b7ce9"}},"CurrNode:  ",-1)),yt={class:"node-body"},vt={style:{padding:"1em 1em 0","border-top":"1px solid #aaa","margin-top":"1em"}},bt={style:{margin:"0 0 1em"}},xt={class:"selected-nodes-box"},Nt=["onClick"],St={class:"node-body"},$t=me({__name:"SelectedNodesPanel",props:{selectedNodeList:{type:Array,required:!0,default:[]},currNode:{type:Object,required:!0,default:()=>({})},maxSelectedNodes:{type:Number,required:!0,default:0}},emits:["removeSelectedNode"],setup(r,{emit:T}){const m=r,k=T,_=S=>{console.log(m.selectedNodeList),k("removeSelectedNode",S)},L=O(""),x=O(null),d=O({});function h(S,D){S&&(d.value[D]=S)}function y(S){S!=null&&Ae(()=>{const D=d.value[S];D&&x.value&&D.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})})}return(S,D)=>{const B=te("el-option"),V=te("el-select");return f(),p("div",null,[a("div",dt,[ut,a("div",ht,[a("div",ft,[a("div",gt,[a("div",mt,[a("h3",pt,[_t,pe(" "+M(r.currNode&&r.currNode.metaData?r.currNode.originalName?r.currNode.originalName+" ("+r.currNode.name+")":r.currNode.metaData.node:"节点信息"),1)])]),a("div",yt,[r.currNode&&r.currNode.metaData?(f(),ee(ge,{key:0,currNode:r.currNode},null,8,["currNode"])):W("",!0)])])],512),a("div",vt,[a("h4",bt," 已选择的节点 ("+M(r.selectedNodeList.length)+") ",1),oe(V,{modelValue:L.value,"onUpdate:modelValue":D[0]||(D[0]=g=>L.value=g),filterable:"",placeholder:"Type to search yours added nodes below...",clearable:"",style:{width:"100%"},onChange:y},{default:_e(()=>[(f(!0),p(E,null,F(r.selectedNodeList,(g,P)=>{var R;return f(),ee(B,{key:g.id,label:((R=g.metaData)==null?void 0:R.node)||g.label,value:P},null,8,["label","value"])}),128))]),_:1},8,["modelValue"])]),a("div",xt,[a("div",{ref_key:"selectedNodesScrollContainer",ref:x,class:"selected-nodes-list"},[(f(!0),p(E,null,F(r.selectedNodeList,(g,P)=>(f(),p("div",{key:P,ref_for:!0,ref:R=>h(R,P),class:"select-node-item"},[a("div",{class:"node-header",style:fe({"border-left":"4px solid ".concat(g.selectedColor)})},[a("h3",{class:"node-title",style:fe({color:g.selectedColor})},M(g.originalName?g.originalName+" ("+g.name+")":g.metaData.node),5),a("button",{class:"close-btn",onClick:R=>_(g.feature_path)}," × ",8,Nt)],4),a("div",St,[g&&g.metaData?(f(),ee(ge,{key:0,currNode:g},null,8,["currNode"])):W("",!0)])]))),128))],512)])])])])}}}),wt=le($t,[["__scopeId","data-v-ee29cc75"]]),ve=r=>(ne("data-v-af17808b"),r=r(),se(),r),kt={class:""},Mt={style:{height:"100vh"}},Tt={id:"viewport",style:{display:"flex"}},Ct={id:"wrapper",style:{flex:"1",overflow:"hidden",height:"100%"}},Dt=ve(()=>a("div",{id:"echart",style:{width:"100%",height:"100%"}},null,-1)),Bt=ve(()=>a("span",{class:"icon"},"+",-1)),It=[Bt],zt={class:"showAllNodes",style:{position:"absolute",right:"20px",top:"5px"}},Et={__name:"echart3",setup(r){let T=null,m={nodes:[],links:[]},k=1,_=null,L=!1,x=null,d=null;const h=O([]),y=O(1e6),S=O();Fe(y,(t,n)=>{if(console.log("最大选择数量从 ".concat(n," 变更为 ").concat(t)),h.value.length>t){const s=h.value.slice(t);h.value=h.value.slice(0,t),console.log("由于限制变更，移除了以下节点:",s),alert("由于限制变更，已移除 ".concat(s.length," 个节点"))}}),We(()=>{const t=document.getElementById("echart").getBoundingClientRect().width,n=document.getElementById("echart").getBoundingClientRect().height,s=Math.min(t,n);k=Math.max(2200/s,1),d=document.getElementById("plusButton"),Be(),console.log("屏幕尺寸：",t,n,2200/s,k);const c=document.getElementById("echart");c&&(_=Ve(c),Promise.all([fetch("./data/webui.json").then(e=>e.json()),fetch("./data/map.json").then(e=>e.json())]).then(([e,o])=>{console.log("webui:",e),console.log("map:",o),V(e.data_flow_graph),T=Pe(e,o),re(1),m=Z(T),we(_)}).catch(e=>{console.error("请求失败:",e)}),Oe(()=>{_.dispose()}))});const D=t=>{re(t),m=Z(T),_.setOption({series:[{data:m.nodes,links:m.links}]}),_.setOption({series:[{center:[0,0]}]})},B=[],V=t=>{t.forEach(n=>{const s=n.from,c=n.to;if(s&&c){const e={source:"1_"+s,target:"1_"+c,type:"rootLink",content:n,label:{show:!0,formatter:n.data_type||n.label||"",color:"#000",fontSize:9,position:"middle"},lineStyle:{color:"#000",width:1,type:"dashed",opacity:1},symbol:["circle","arrow"],symbolSize:[4,8]};B.push(e)}}),console.log(B)};function g(t){const n=[{name:"test1",x:t,y:t},{name:"test2",x:-t,y:-t},{name:"test3",x:-t,y:t},{name:"test4",x:t,y:-t}];return console.log("Dddd"),n.map(s=>({...s,id:s.name,itemStyle:{opacity:0},label:{show:!1}}))}const P=g(500),R=t=>({0:0,1:110,2:210,3:310,4:420,5:500})[t]||420+(t-6)*40,I=["#686759","#0068B8","#62BDE4","#52E0FC","#86DCF8","#BAD7F3"],ie=t=>{let n;return t==0?n=5:t==1?n=100/k:t==2?n=80/k:t==3?n=70/k:t==4?n=38/k:n=30/k,n},be=t=>t<=1?{color:I[t%I.length],borderColor:I[t%I.length],borderWidth:.5,opacity:1}:{color:I[t%I.length],borderColor:I[t%I.length],borderWidth:.5},xe=(t,n)=>({color:t==1?"rgba(0,0,0,.1)":I[t%I.length],width:1}),Ne=(t,n=0,s="",c=0,e)=>{if(t>=5){let i=n*180/Math.PI;const v=Se(0,0,(e==null?void 0:e.x)+0,(e==null?void 0:e.y)+0,100,s),N=ie(5);return{show:!0,position:[v.dx+N,v.dy+N],fontSize:10,color:"#333",fontWeight:"normal",align:"center",verticalAlign:"middle",rotate:i>90&&i<270?180-i:-i}}let o={};return t==0?o={fontSize:12,color:"#333",fontWeight:"normal"}:o={position:"inside",fontSize:t===1?12:11,color:t==1?"#fff":"#333",verticalAlign:"middle",align:"center",fontWeight:t===1?"bold":"normal",width:200},o};function Y(t,n=10,s="Arial"){const e=(Y._canvas||(Y._canvas=document.createElement("canvas"))).getContext("2d");return e.font="".concat(n,"px ").concat(s),e.measureText(t).width}const Se=(t,n,s,c,e=30,o)=>{o.length*3,e=Y(o)/2+25;const v=s-t,N=c-n,l=Math.atan2(N,v),b=l*(180/Math.PI),u=Math.cos(l)*e,C=Math.sin(l)*e;return{dx:u,dy:C,angleDeg:b}},Z=t=>{function n(l){if(!l||l.visible===!1)return null;const b={...l};return b.children&&Array.isArray(b.children)&&(b.children=b.children.map(n).filter(u=>!!u)),b}const s=n(t);console.log("开始转换为 Graph 数据格式 treeData",s);const c=[],e=[],o=new Map;function i(l,b=0){function u($){let w=1;return $<=1?w=1:$==1?w=.75:$==2?w=.5:$==3?w=.3:$==4?w=.25:w=.08,w}if(!l.children||l.children.length===0)return u(b);const C=l.children.reduce(($,w)=>$+i(w,b+1),0),A=u(b);return Math.max(C,A)}function v(l,b=null,u=0,C=0,A=2*Math.PI){if(!l||!l.name||l.visible===!1)return;const $=u<=1?u+"_"+(l.feature_path||l.name):u+"_"+l.id+"_"+(l.feature_path||l.name),w=R(u);let z,q=0,H=0;u===0?(q=0,H=0,z=0):(z=(C+A)/2,q=Math.cos(z)*w,H=Math.sin(z)*w);const Ie={id:$,name:l.name||"Unknown",originalName:l.originalName?l.originalName:null,feature_path:l.feature_path||"",level:u,metaData:l.metaData,x:q,y:H,angle:z,sectorStart:C,sectorEnd:A,fixed:!0,symbolSize:l.symbolSize||ie(u),label:Ne(u,z,l.name||"",w,{x:q,y:H}),itemStyle:l.itemStyle||be(u),category:u};if(u!=0&&c.push(Ie),o.set(l.name,$),b&&u>=2&&e.push({source:b,target:$,lineStyle:l.lineStyle||xe(u)}),l.children&&l.children.length>0){const ce=l.children.map(U=>i(U,u+1)),ze=ce.reduce((U,Q)=>U+Q,0);let de=A-C;u===0&&(de=2*Math.PI);let K=C;l.children.forEach((U,Q)=>{const Ee=ce[Q]/ze*de,Le=K,ue=K+Ee;v(U,$,u+1,Le,ue),K=ue})}}v(s,null,0,0,2*Math.PI),console.log("Graph 节点布局完成，节点数量:",c.length,c,e),Re(s)<=2?B.forEach(l=>{l.label.show=!0}):B.forEach(l=>{l.label.show=!1});let N=[...B,...e];return console.log("!!!linksResult",N),{nodes:[...P,...c],links:N}},re=t=>{function n(s,c){s.visible=c<=t,s.children&&s.children.length>0&&s.children.forEach(e=>n(e,c+1))}T&&n(T,0)},$e=t=>{function n(e,o){if(e.feature_path===o)return e;if(e.children)for(const i of e.children){const v=n(i,o);if(v)return v}return null}const s=n(T,t);let c=!1;if(s&&s.children){for(const e of s.children)if(e.visible===!1){c=!0;break}s.children.forEach(e=>{if(e.visible=!e.visible,!e.visible&&e.children){const o=i=>{i.visible=!1,i.children&&i.children.forEach(o)};o(e)}})}return c},we=t=>{if(!m||!m.nodes||m.nodes.length===0){console.error("Graph 数据不存在或为空:",m);return}console.log("初始化 Graph 图表，节点数量:",m.nodes.length);var n={tooltip:{trigger:"item",triggerOn:"mousemove",extraCssText:"max-width: 400px; white-space: normal;",formatter:function(e){if(e.dataType==="node"){const o=e.data;let i="<strong>Node: </strong>".concat(o.originalName?o.originalName+" ("+o.name+")":o.name," <br/>");return o.feature_path&&(i+="<strong>Feature Path: </strong> ".concat(o.feature_path,"<br/>")),i}if(e.dataType==="edge"&&e.data&&e.data.type==="rootLink"){let o="<strong>Flow Graph:</strong><br/>";return o+="<strong>From: </strong> ".concat(e.data.content.from,"<br/>"),o+="<strong>To: </strong> ".concat(e.data.content.to,"<br/>"),e.data.label&&e.data.label.formatter&&(o+="<strong>Data Type: </strong> ".concat(e.data.content.data_type,"<br/>")),o}return e.dataType==="edge"?"":e.name||""}},series:[{type:"graph",layout:"none",roam:!0,zoom:k,center:[0,0],scaleLimit:{min:k*.7,max:k*1.2},data:m.nodes,links:m.links,symbol:"circle",symbolSize:30,label:{show:!0,position:function(e){return e&&e.data&&e.data.level>=5?"right":"inside"},fontSize:function(e){return e&&e.data&&e.data.level>=5?10:12},formatter:function(e){var o=e.name||"";if(e&&e.data&&e.data.level>=3)return o;for(var i=o.split(" "),v=[],N=0;N<i.length;N++){var l=i[N];v.push(l)}return v.join("\n")}},lineStyle:{color:"source",curveness:0,width:1},animationDurationUpdate:750,animationEasingUpdate:"quinticInOut"}]};t.setOption(n),setTimeout(()=>{if(m.nodes&&m.nodes.length>0){const e=m.nodes[0];J(e)}},100),t.on("mouseover",function(e){if(e.componentType==="series"&&e.dataType==="node"&&e.data.level>1){const o=e.data.feature_path;if(clearTimeout(G),j===o)return;j=o,J(e.data)}}),t.on("mouseout",function(e){if(e.componentType==="series"&&e.dataType==="node"&&e.data.level>1){const o=e.data.feature_path;if(j!==o)return;clearTimeout(G),G=setTimeout(()=>{j===o&&!Te()&&(X(),j=null)},200)}});let s=null,c=t.getModel().getSeriesByIndex(0).coordinateSystem.getRoamTransform();t.on("graphRoam",function(){L=!0,console.log("拖拽/缩放开始",x);const o=t.getModel().getSeriesByIndex(0).coordinateSystem.getRoamTransform();let i=!1;if(Array.isArray(o)&&o.length===6){const[v,N,l,b,u,C]=o,[A,$,w,z,q,H]=c;i=v!==A||b!==z}else o&&o.zoom!==void 0&&o.position&&(i=o.zoom!==c.zoom,o.position[0]!==c.position[0]||(o.position[1],c.position[1]));c=o,i&&(s&&(clearTimeout(s),s=null),s=setTimeout(()=>{console.log("///// 重新设置图表选项"),t.setOption({series:[{data:m.nodes,links:m.links}]})},300)),X(),setTimeout(()=>{L=!1,console.log("拖拽/缩放结束")},300)}),t.on("mousedown",function(){console.log("mousedown"),L=!0,X()}),t.on("mouseup",function(){console.log("mouseup"),setTimeout(()=>{L=!1,console.log("鼠标操作结束")},100)}),t.on("click",function(e){if(e.dataType==="node"){console.log("params.data",e.data);const o=e.data.feature_path;$e(o),m=Z(T),t.setOption({series:[{data:m.nodes,links:m.links}]}),ke(e.data),e.data.level>1&&(S.value=e.data)}})};function ke(t){if(!_||!t)return;console.log("@@@",t);const n=_.convertToPixel({seriesIndex:0},[t.x,t.y]),s=_.getDom(),c=s.offsetWidth,e=s.offsetHeight,o=_.getModel().getSeriesByIndex(0).option.zoom,i=80*o,[v,N]=n;let l=!1;if((v<i||v>c-i||N<i||N>e-i)&&(l=!0),l){console.log("needMove");const{x:b,y:u}=t,C=Math.sqrt(b*b+u*u);if(C===0)return;const $=Math.max(0,C-200/o)/C,w=b*$,z=u*$;_.setOption({series:[{center:[w,z]}]})}}const Me=()=>{if(!(x&&x.level<=1)&&x){const t=x.feature_path;if(h.value.some(s=>s.feature_path===t))console.log("点击减号，移除节点:",x),h.value=h.value.filter(s=>s.feature_path!==t);else{if(h.value.length>=y.value){alert("最多只能选择 ".concat(y.value," 个节点！"));return}console.log("点击加号，添加节点:",x),h.value.unshift(x),console.log("!!!!",h)}console.log("当前选择的节点列表:",h.value),J(x)}},J=t=>{if(!(!d||L))try{const n=h.value.some(l=>l.feature_path===t.feature_path),s=_.convertToPixel("series",[t.x,t.y]),c=t.symbolSize||30;console.log(s);const o=_.getModel().getSeriesByIndex(0).coordinateSystem.getRoamTransform();let i=1;Array.isArray(o)&&o.length===6?i=o[0]:o&&typeof o.zoom=="number"&&(i=o.zoom);const v=c/2*i*Math.sin(Math.PI/4),N=-c/2*i*Math.sin(Math.PI/4);d.style.left=s[0]+v+"px",d.style.top=s[1]+N+"px",d.style.display="flex",n?(d.getElementsByClassName("icon")[0].textContent="−",d.style.backgroundColor="#f56c6c",d.title="点击取消选择"):h.value.length>=y.value?(d.getElementsByClassName("icon")[0].textContent="+",d.style.backgroundColor="#909399",d.title="已达到最大选择数量 (".concat(h.value.length,"/").concat(y.value,")")):(d.getElementsByClassName("icon")[0].textContent="+",d.style.backgroundColor="#409eff",d.title="点击选择节点 (".concat(h.value.length,"/").concat(y.value,")")),x=t}catch(n){console.error("显示按钮失败:",n)}},X=()=>{clearTimeout(G),d&&(d.style.display="none"),x=null,j=null},Te=()=>d?d.matches(":hover"):!1,Ce=t=>{h.value=h.value.filter(n=>n.feature_path!==t),console.log("移除节点:",t),console.log("当前选择的节点列表:",h.value)},De=t=>{y.value=t,console.log("从组件更新最大选择节点数量为:",t)},Be=()=>{d&&(d.addEventListener("mouseenter",()=>{console.log("鼠标进入加号按钮"),clearTimeout(G)}),d.addEventListener("mouseleave",()=>{console.log("鼠标离开加号按钮"),X()}))};let G=null,j=null;return(t,n)=>{const s=te("el-button");return f(),p("div",kt,[a("div",Mt,[a("div",Tt,[oe(wt,{style:{width:"20%","min-width":"300px","max-width":"600px"},selectedNodeList:h.value,maxSelectedNodes:y.value,currNode:S.value,onRemoveSelectedNode:Ce,onUpdateMaxNodes:De},null,8,["selectedNodeList","maxSelectedNodes","currNode"]),a("div",Ct,[Dt,a("div",{id:"plusButton",class:"plus-button",style:{display:"none"},onClick:Me},It),a("div",zt,[oe(s,{type:"primary",onClick:n[0]||(n[0]=c=>D(5))},{default:_e(()=>[pe("展开所有")]),_:1})])])])])])}}},At=le(Et,[["__scopeId","data-v-af17808b"]]);export{At as default};
