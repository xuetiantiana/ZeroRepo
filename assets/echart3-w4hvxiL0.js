import{h as j,g as P}from"./util--hDIOo22.js";import{i as tt}from"./index-CVOXnaBf.js";import{_ as et,o as nt,a as ot,b as rt,c as it,p as at,e as st,d as v}from"./index-B7VM7HEP.js";const ct=D=>(at("data-v-8a19bb51"),D=D(),st(),D),lt={class:""},ht=ct(()=>v("div",{class:"header"},[v("h3",null,"ECharts Graph 图表 (无交叉扇形布局)"),v("div",{id:"viewport"},[v("div",{id:"wrapper"},[v("div",{id:"echart",style:{width:"100%",height:"100%"}})])])],-1)),dt=[ht],ft={__name:"echart3",setup(D){let _=null,b={nodes:[],links:[]},y=1,x=null;nt(()=>{const e=window.innerWidth,r=window.innerHeight,t=Math.min(e,r);y=Math.max(1800/t,1),console.log("屏幕尺寸：",e,r,1800/t,y);const i=document.getElementById("echart");i&&(x=tt(i),fetch("./data/webui.json").then(n=>n.json()).then(n=>{G(n.data_flow_graph),_=j(n),U(1),b=T(_),X(x)}),ot(()=>{x.dispose()}))});const w=[],G=e=>{e.forEach(r=>{const t=r.from,i=r.to;if(t&&i){const n={source:"1_"+t,target:"1_"+i,type:"rootLink",content:r,label:{show:!0,formatter:r.data_type||r.label||"",color:"#000",fontSize:9,position:"middle"},lineStyle:{color:"#000",width:1,type:"dashed",opacity:1},symbol:["circle","arrow"],symbolSize:[4,8]};w.push(n)}}),console.log(w)};function L(e){const r=[{name:"test1",x:e,y:e},{name:"test2",x:-e,y:-e},{name:"test3",x:-e,y:e},{name:"test4",x:e,y:-e}];return console.log("Dddd"),r.map(t=>({...t,id:t.name,itemStyle:{opacity:0},label:{show:!1}}))}const N=L(500),E=["#686759","#B04B35","#E37C05","#5F9DBF","#568651","#B89C80"],S=["#686759","#cfb9b4","#ebc59a","#a4cadf","#cdefca","#B89C80"],O=e=>{let r;return e==0?r=5:e==1?r=82/y:e<=4?r=42/y:r=5/y,r},$=e=>e<=1?{color:S[e%S.length],borderColor:S[e%S.length],borderWidth:.5}:{color:S[e%S.length],borderColor:S[e%S.length],borderWidth:.5},A=e=>({color:e==1?"rgba(0,0,0,.1)":E[e%E.length],width:1}),R=(e,r=0,t="",i=0,n)=>{if(e>=5){let s=r*180/Math.PI;console.log("!!!!","angle",r,"deg",s,"x和y坐标",n);const f=V(0,0,n==null?void 0:n.x,n==null?void 0:n.y,100,t);return{show:!0,position:[f.dx,f.dy],fontSize:12,color:"#333",fontWeight:"normal",align:"center",verticalAlign:"middle",rotate:s>90&&s<270?180-s:-s,formatter:function(u){var o=u.name||"";if(u&&u.data&&u.data.level>=5)return s>90&&s<270?"{main|".concat(o,"    } {sub|}"):"{sub|} {main|    ".concat(o,"}");for(var l=o.split(" "),a=[],g=0;g<l.length;g++){var m=l[g];if(m.indexOf("-")!==-1)for(var d=m.split("-"),h=0;h<d.length;h++)a.push(d[h]),h<d.length-1&&a.push("-");else a.push(m)}return a.join("\n")},rich:{main:{fontSize:10,color:"#000"},sub:{fontSize:10,color:"rgba(0, 0, 0, .1)",height:-1}}}}let c={};return e==0?c={fontSize:12,color:"#333",fontWeight:"normal"}:c={position:"inside",fontSize:11,color:"#333",verticalAlign:"middle",align:"center",fontWeight:e===1?"bold":"normal",width:200},c},V=(e,r,t,i,n=30,c)=>{n=c.length*2.5,console.log("labelText",c.length,n);const u=t-e,o=i-r,l=Math.atan2(o,u),a=l*(180/Math.PI),g=Math.cos(l)*n,m=Math.sin(l)*n;return{dx:g,dy:m,angleDeg:a}},H=e=>({0:0,1:140,2:240,3:340,4:440,5:500})[e]||420+(e-6)*40,T=e=>{function r(o){if(!o||o.visible===!1)return null;const l={...o};return l.children&&Array.isArray(l.children)&&(l.children=l.children.map(r).filter(a=>!!a)),l}const t=r(e);console.log("开始转换为 Graph 数据格式 treeData",t);const i=[],n=[],c=new Map;function s(o,l=0){function a(d){let h=1;return d<=1?h=1:d==1?h=.75:d==2?h=.5:d==3?h=.3:d==4?h=.25:h=.08,h}if(!o.children||o.children.length===0)return a(l);const g=o.children.reduce((d,h)=>d+s(h,l+1),0),m=a(l);return Math.max(g,m)}function f(o,l=null,a=0,g=0,m=2*Math.PI){if(!o||!o.name||o.visible===!1)return;const d=a+"_"+(o.feature_path||o.name),h=H(a);let p,z=0,k=0;a===0?(z=0,k=0,p=0):(p=(g+m)/2,z=Math.cos(p)*h,k=Math.sin(p)*h);const J={id:d,name:o.name||"Unknown",feature_path:o.feature_path||"",level:a,x:z,y:k,angle:p,sectorStart:g,sectorEnd:m,fixed:!0,symbolSize:o.symbolSize||O(a),label:R(a,p,o.name||"",h,{x:z,y:k}),itemStyle:o.itemStyle||$(a),category:a};if(a!=0&&i.push(J),c.set(o.name,d),l&&a>=2&&n.push({source:l,target:d,lineStyle:o.lineStyle||A(a)}),o.children&&o.children.length>0){const C=o.children.map(M=>s(M,a+1)),K=C.reduce((M,W)=>M+W,0);let F=m-g;a===0&&(F=2*Math.PI);let I=g;o.children.forEach((M,W)=>{const Q=C[W]/K*F,Z=I,B=I+Q;f(M,d,a+1,Z,B),I=B})}}f(t,null,0,0,2*Math.PI),console.log("Graph 节点布局完成，节点数量:",i.length,i,n),P(t)<=2?w.forEach(o=>{o.label.show=!0}):w.forEach(o=>{o.label.show=!1});let u=[...w,...n];return console.log("!!!linksResult",u),{nodes:[...N,...i],links:u}},U=e=>{function r(t,i){t.visible=i<=e,t.children&&t.children.length>0&&t.children.forEach(n=>r(n,i+1))}_&&r(_,0)},q=e=>{function r(n,c){if(n.feature_path===c)return n;if(n.children)for(const s of n.children){const f=r(s,c);if(f)return f}return null}const t=r(_,e);let i=!1;if(t&&t.children){for(const n of t.children)if(n.visible===!1){i=!0;break}t.children.forEach(n=>{if(n.visible=!n.visible,!n.visible&&n.children){const c=s=>{s.visible=!1,s.children&&s.children.forEach(c)};c(n)}})}return i},X=e=>{if(!b||!b.nodes||b.nodes.length===0){console.error("Graph 数据不存在或为空:",b);return}console.log("初始化 Graph 图表，节点数量:",b.nodes.length);var r={tooltip:{trigger:"item",triggerOn:"mousemove",extraCssText:"max-width: 400px; white-space: normal;",formatter:function(t){if(t.dataType==="node"){const i=t.data;let n="<strong>Node: </strong> ".concat(i.name,"<br/>");return i.feature_path&&(n+="<strong>Feature Path: </strong> ".concat(i.feature_path,"<br/>")),n}if(t.dataType==="edge"&&t.data&&t.data.type==="rootLink"){let i="<strong>Flow Graph:</strong><br/>";return i+="<strong>From: </strong> ".concat(t.data.content.from,"<br/>"),i+="<strong>To: </strong> ".concat(t.data.content.to,"<br/>"),t.data.label&&t.data.label.formatter&&(i+="<strong>Data Type: </strong> ".concat(t.data.content.data_type,"<br/>")),i}return t.dataType==="edge"?"":t.name||""}},series:[{type:"graph",layout:"none",roam:!0,zoom:y,center:[0,0],scaleLimit:{min:y*.7,max:y*5},data:b.nodes,links:b.links,symbol:"circle",symbolSize:30,label:{show:!0,position:function(t){return t&&t.data&&t.data.level>=5?"right":"inside"},fontSize:function(t){return t&&t.data&&t.data.level>=5?10:12},formatter:function(t){var i=t.name||"";if(t&&t.data&&t.data.level>=5)return i+" - 111111"+i;for(var n=i.split(" "),c=[],s=0;s<n.length;s++){var f=n[s];if(f.indexOf("-")!==-1)for(var u=f.split("-"),o=0;o<u.length;o++)c.push(u[o]),o<u.length-1&&c.push("-");else c.push(f)}return c.join("\n")}},lineStyle:{color:"source",curveness:0,width:1},animationDurationUpdate:750,animationEasingUpdate:"quinticInOut"}]};e.setOption(r),e.on("click",function(t){if(t.dataType==="node"){const i=t.data.feature_path;q(i),b=T(_),e.setOption({series:[{data:b.nodes,links:b.links}]}),Y(t.data)}})};function Y(e){if(!x||!e)return;console.log("@@@",e);const r=x.convertToPixel({seriesIndex:0},[e.x,e.y]),t=x.getDom(),i=t.offsetWidth,n=t.offsetHeight,c=x.getModel().getSeriesByIndex(0).option.zoom,s=80*c,[f,u]=r;let o=!1;if((f<s||f>i-s||u<s||u>n-s)&&(o=!0),o){console.log("needMove");const{x:l,y:a}=e,g=Math.sqrt(l*l+a*a);if(g===0)return;const d=Math.max(0,g-200/c)/g,h=l*d,p=a*d;x.setOption({series:[{center:[h,p]}]})}}return(e,r)=>(rt(),it("div",lt,dt))}},bt=et(ft,[["__scopeId","data-v-8a19bb51"]]);export{bt as default};
